<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>

<ui:composition
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:h="jakarta.faces.html"
    xmlns:f="jakarta.faces.core"
    xmlns:ui="jakarta.faces.facelets"
    template="/WEB-INF/templates/adminlayout.xhtml">

    <ui:define name="title">Add User</ui:define>

    <ui:define name="content">

        <!-- ✅ FONT AWESOME (MANDATORY) -->
        <link rel="stylesheet"
              href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"/>

        <!-- ✅ SWEET ALERT -->
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

        <style>
            .btn {
                background:#2563eb;
                color:#fff;
                padding:10px 22px;
                border-radius:10px;
                border:none;
                cursor:pointer;
                font-weight:600;
            }
            .btn:hover {
                background:#1e40af;
            }

            .card {
                background:#fff;
                padding:22px;
                border-radius:14px;
                box-shadow:0 10px 30px rgba(0,0,0,.08);
            }

            table {
                width:100%;
                border-collapse:collapse;
            }
            th {
                background:#f8fafc;
                padding:12px;
                text-align:left;
            }
            td {
                padding:12px;
                border-bottom:1px solid #e5e7eb;
            }

            .delete-link {
                color:#ef4444;
                font-size:18px;
                cursor:pointer;
                text-decoration:none;
            }
            .delete-link:hover {
                color:#991b1b;
            }

            .modal {
                display:none;
                position:fixed;
                inset:0;
                background:rgba(0,0,0,.45);
                justify-content:center;
                align-items:center;
                z-index:999;
            }
            .modal-content {
                width:460px;
            }

            .form-group {
                margin-bottom:14px;
            }
            label {
                font-weight:600;
                display:block;
                margin-bottom:6px;
            }
            .input {
                width:100%;
                padding:10px;
                border-radius:8px;
                border:1px solid #d1d5db;
            }
        </style>

        <script>
            function openModal() {
                document.getElementById('modal').style.display = 'flex';
            }
            function closeModal() {
                document.getElementById('modal').style.display = 'none';
            }

            function confirmDelete() {
                return confirm('Are you sure you want to delete this user?');
            }

            function toast(msg) {
                Swal.fire({
                    toast: true,
                    position: 'top-end',
                    icon: 'success',
                    title: msg,
                    showConfirmButton: false,
                    timer: 2500
                });
            }
        </script>

        <h:form id="userForm">

            <!-- Toast bridge -->
            <h:messages id="msgs" globalOnly="true" style="display:none"/>
            <h:outputScript rendered="#{not empty facesContext.messageList}">
                toast("#{facesContext.messageList[0].summary}");
            </h:outputScript>

            <!-- ADD USER BUTTON -->
            <button type="button" class="btn" onclick="openModal()">
                <i class="fa fa-user-plus"></i> Add User
            </button>

            <div style="height:25px"></div>

            <!-- TABLE -->
            <div class="card">
                <h:dataTable value="#{adminRoleUserBean.admins}" var="a">

                    <h:column>
                        <f:facet name="header">Name</f:facet>
                            #{a.username}
                    </h:column>

                    <h:column>
                        <f:facet name="header">Email</f:facet>
                            #{a.email}
                    </h:column>

                    <h:column>
                        <f:facet name="header">Role</f:facet>
                            #{a.role.role}
                    </h:column>

                    <h:column>
                        <f:facet name="header">Action</f:facet>

                        <!-- ✅ DELETE ICON (WORKING) -->
                        <h:commandLink
                            action="#{adminRoleUserBean.deleteUser(a.adminId)}"
                            onclick="return confirmDelete()"
                            immediate="true"
                            styleClass="delete-link">
                            <i class="fa-solid fa-trash"></i>
                        </h:commandLink>

                    </h:column>
                </h:dataTable>
            </div>

            <!-- MODAL -->
            <div id="modal" class="modal">
                <div class="modal-content card">

                    <span style="float:right;cursor:pointer" onclick="closeModal()">✖</span>
                    <h3>Add User</h3>

                    <div class="form-group">
                        <label>Name</label>
                        <h:inputText value="#{adminRoleUserBean.name}" required="true" styleClass="input"/>
                    </div>

                    <div class="form-group">
                        <label>Email</label>
                        <h:inputText value="#{adminRoleUserBean.email}" required="true" styleClass="input"/>
                    </div>

                    <div class="form-group">
                        <label>Password</label>
                        <h:inputSecret value="#{adminRoleUserBean.password}" required="true" styleClass="input"/>
                    </div>

                    <div class="form-group">
                        <label>Phone</label>
                        <h:inputText value="#{adminRoleUserBean.phone}" styleClass="input"/>
                    </div>

                    <div class="form-group">
                        <label>Role</label>
                        <h:selectOneMenu value="#{adminRoleUserBean.roleId}" required="true" styleClass="input">
                            <f:selectItem itemLabel="-- Select Role --" itemValue="#{null}"/>
                            <f:selectItem itemLabel="Admin" itemValue="2"/>
                            <f:selectItem itemLabel="Manager" itemValue="3"/>
                            <f:selectItem itemLabel="Staff" itemValue="4"/>
                        </h:selectOneMenu>
                    </div>

                    <h:commandButton value="Save"
                                     action="#{adminRoleUserBean.addUser}"
                                     styleClass="btn"/>
                </div>
            </div>

        </h:form>

    </ui:define>
</ui:composition>
