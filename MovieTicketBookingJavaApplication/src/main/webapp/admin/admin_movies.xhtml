<ui:composition template="/WEB-INF/templates/adminlayout.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="jakarta.faces.html"
                xmlns:f="jakarta.faces.core"
                xmlns:ui="jakarta.faces.facelets">

    <ui:define name="title">Manage Movies</ui:define>

    <ui:define name="content">

        <div class="page-container">

            <!-- PAGE TITLE -->
            <h2 class="page-title">Manage Movies</h2>

            <!-- TOP BAR -->
            <div class="top-bar">
                <h:link outcome="add_movie.xhtml"
                        value="+ Add New Movie"
                        styleClass="add-btn"/>
            </div>

            <!-- MOVIE TABLE -->
            <h:form id="movieForm">
                <h:dataTable value="#{adminMovieController.movieList}"
                             var="m"
                             styleClass="movie-table"
                             headerClass="table-header"
                             rowClasses="row-even,row-odd">

                    <!-- POSTER -->
                    <h:column>
                        <f:facet name="header">Poster</f:facet>
                        <h:graphicImage library="images"
                                        name="#{m.posterImagePath}"
                                        styleClass="poster-img"/>
                    </h:column>

                    <!-- TITLE -->
                    <h:column>
                        <f:facet name="header">Title</f:facet>
                            #{m.movieTitle}
                    </h:column>

                    <!-- GENRE -->
                    <h:column>
                        <f:facet name="header">Genre</f:facet>
                            #{m.genre}
                    </h:column>

                    <!-- PRICE -->
                    <h:column>
                        <f:facet name="header">Price</f:facet>
                        ₹#{m.ticketPrice}
                    </h:column>

                    <!-- ACTIONS -->
                    <h:column>
                        <f:facet name="header">Actions</f:facet>

                        <h:commandButton value="Edit"
                                         styleClass="btn-edit"
                                         action="#{adminMovieController.editMovie(m)}"/>

                        <h:commandButton value="Delete"
                                         styleClass="btn-delete"
                                         action="#{adminMovieController.deleteMovie(m.movieId)}"
                                         onclick="return confirm('Delete #{m.movieTitle}?');"
                                         immediate="true"/>
                    </h:column>

                </h:dataTable>
            </h:form>

            <!-- PAGINATION -->
            <div class="pagination">
                <button type="button" onclick="prevPage()">« Previous</button>
                <span id="pageInfo"></span>
                <button type="button" onclick="nextPage()">Next »</button>
            </div>

        </div>

        <!-- ================= CSS ================= -->
        <style>
            .page-container {
                padding: 32px;
                background: #F5F7FB;
                min-height: 100vh;
                font-family: "Segoe UI", Roboto, sans-serif;
            }

            .page-title {
                font-size: 28px;
                font-weight: 600;
                color: #1F2937;
                margin-bottom: 20px;
            }

            .top-bar {
                display: flex;
                justify-content: flex-end;
                margin-bottom: 16px;
            }

            .add-btn {
                background: #2563EB;
                color: #fff;
                padding: 10px 18px;
                border-radius: 6px;
                font-weight: 500;
                text-decoration: none;
            }

            .add-btn:hover {
                background: #1D4ED8;
            }

            .movie-table {
                width: 100%;
                border-collapse: separate;
                border-spacing: 0;
                background: #fff;
                border-radius: 10px;
                overflow: hidden;
                box-shadow: 0 4px 20px rgba(0,0,0,0.06);
            }

            .table-header {
                background: #EEF2FF;
                color: #374151;
                font-size: 14px;
                text-transform: uppercase;
                padding: 14px;
            }

            td {
                padding: 14px;
                font-size: 14px;
                color: #374151;
                border-bottom: 1px solid #E5E7EB;
                text-align: center;
            }

            .row-even {
                background: #FFFFFF;
            }
            .row-odd  {
                background: #FAFBFF;
            }

            .poster-img {
                width: 65px;
                height: 90px;
                border-radius: 6px;
                object-fit: cover;
                border: 1px solid #E5E7EB;
            }

            .btn-edit {
                background: #E0E7FF;
                color: #1E3A8A;
                padding: 6px 14px;
                border-radius: 6px;
                border: none;
                margin-right: 6px;
                cursor: pointer;
            }

            .btn-delete {
                background: #FEE2E2;
                color: #991B1B;
                padding: 6px 14px;
                border-radius: 6px;
                border: none;
                cursor: pointer;
            }

            .pagination {
                margin-top: 20px;
                display: flex;
                justify-content: center;
                gap: 12px;
            }

            .pagination button {
                background: #2563EB;
                color: #fff;
                border: none;
                padding: 8px 14px;
                border-radius: 6px;
                cursor: pointer;
            }

            .pagination span {
                font-weight: 500;
                color: #374151;
            }
        </style>

        <!-- ================= JS ================= -->
        <script type="text/javascript">
            //<![CDATA[
            let currentPage = 1;
            const rowsPerPage = 5;

            function paginateTable() {
                const rows = document.querySelectorAll(".movie-table tbody tr");
                const totalPages = Math.ceil(rows.length / rowsPerPage);

                rows.forEach((row, index) => {
                    if (
                            index >= (currentPage - 1) * rowsPerPage &&
                            index < currentPage * rowsPerPage
                            ) {
                        row.style.display = "";
                    } else {
                        row.style.display = "none";
                    }
                });

                document.getElementById("pageInfo").innerText =
                        "Page " + currentPage + " of " + totalPages;
            }

            function nextPage() {
                const rows = document.querySelectorAll(".movie-table tbody tr");
                if (currentPage < Math.ceil(rows.length / rowsPerPage)) {
                    currentPage++;
                    paginateTable();
                }
            }

            function prevPage() {
                if (currentPage > 1) {
                    currentPage--;
                    paginateTable();
                }
            }

            window.onload = paginateTable;
            //]]>
        </script>

    </ui:define>

</ui:composition>
