<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="jakarta.faces.html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="jakarta.faces.core">

    <h:head>
        <title>Movie Ticket Booking System</title>
        <h:outputStylesheet library="css" name="styles.css" />

    </h:head>
    <h:body>
        <div class="navbar">
            <div class="navbar-left">
                <div class="navbar-title">üé¨ MovieBooker</div>

                <h:link outcome="movie" styleClass="navbar-link">
                    <h:outputText value="Movie" />
                </h:link>

                <h:link outcome="about" styleClass="navbar-link">
                    <h:outputText value="About" />
                </h:link>
            </div>

            <div class="navbar-right">
                <h:form id="searchForm">
                    <h:inputText id="searchBox" styleClass="search-box"
                                 value="#{searchController.searchQuery}"

                                 onkeyup="jsf.ajax.request(this, event, {execute: 'searchBox', render: 'suggestions'});" 
                                 />
                    
                    <h:panelGroup id="suggestions" layout="block" styleClass="suggestion-box"
                                  rendered="#{not empty searchController.filteredMovies}">
                        <ui:repeat value="#{searchController.filteredMovies}" var="movie">
                            <div class="suggestion-item"
                                 onclick="window.location.href = 'MovieDetail.xhtml?movieId=#{movie.movieId}'">
                                üé¨ #{movie.movieTitle}
                            </div>
                        </ui:repeat>
                    </h:panelGroup>

                    <h:commandButton value="Search"
                                     styleClass="search-button"
                                     action="#{searchController.performSearch()}" />
                </h:form>

                <h:panelGroup rendered="#{not empty sessionScope.user}">
                    <div class="user-menu">
                        <div class="user-icon" onclick="toggleLogoutMenu()">
                            #{sessionScope.user.username.substring(0,1).toUpperCase()}
                        </div>
                        <div id="logoutBox" class="logout-box" style="display:none;">
                            <h:form id="logoutForm"> <a href="#" class="logout-btn" onclick="return confirmLogout(event);">
                                    Logout
                                </a>
                                <h:commandButton id="realLogout"
                                                 action="#{userAuthBean.logout}"
                                                 style="display:none;" />
                            </h:form>
                        </div>
                    </div>
                </h:panelGroup>
                <h:panelGroup rendered="#{empty sessionScope.user}">
                    <h:link outcome="login" styleClass="login-button">Login</h:link>
                    <h:link outcome="register" styleClass="btn-register">Register</h:link>
                </h:panelGroup>
            </div>
        </div>

        <!--        <div style="padding: 20px;">
                    <h2>Welcome to the Movie Booking System!</h2>
                    <p>This is where the main content (e.g., list of movies) will go.</p>
                </div>-->
        
        <!-- üîÅ Image Slider Section -->
        <div class="hero-slider">
            <ui:repeat value="#{adminMovieController.movieList}" var="m" begin="0" end="1" varStatus="loop">
                <div class="slide #{loop.index == 0 ? 'active' : ''}" 
                     style="background-image: url('#{resource['images/' += m.posterImagePath]}');">

                    <div class="slide-content">
                        <h2>#{m.movieTitle}</h2>
                        <p>#{m.genre}</p> 
                        <p class="tag">#1 on Trend</p> 
                        <div class="buttons">
                            <h:link outcome="MovieDetail" styleClass="btn-secondary">
                                <f:param name="movieId" value="#{m.movieId}" />
                                <h:outputText value="Watch Now" />
                            </h:link>
                            <button class="btn-secondary">View Trailer</button>
                        </div>
                    </div>
                </div>
            </ui:repeat>



            <div class="dots">
                <ui:repeat value="#{adminMovieController.movieList}" var="m" begin="0" end="1" varStatus="loop">
                    <span class="dot #{loop.index == 0 ? 'active' : ''}"></span>
                </ui:repeat>
            </div>
        </div>

        <!-- üé¨ Recommended Movies Section -->
        <div class="movies-section">
            <h2>Recommended Movies</h2>
            <div class="movies-grid">
                <!-- Dynamic movie loop -->
                <ui:repeat value="#{adminMovieController.movieList}" var="m">
                    <h:link outcome="MovieDetail" styleClass="movie-card-link">
                        <f:param name="movieId" value="#{m.movieId}" />
                        <div class="movie-card">
                            <div class="poster-container">

                                <h:graphicImage library="images" name="#{m.posterImagePath}" width="150" height="220"/>

                                <div class="rating-bar">
                                    <span class="rating">‚≠ê #{m.avgRating}/10</span>
                                    <span class="votes">#{m.voteCount}+ Votes</span>
                                </div>
                            </div>

                            <div class="movie-details">
                                <h3>#{m.movieTitle}</h3>
                                <p>#{m.genre}</p>
                            </div>
                        </div>
                    </h:link>

                </ui:repeat>

            </div>
        </div>

        <h:outputScript library="js" name="script.js" />
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <h:panelGroup rendered="#{flash.logoutSuccess}">
            <script>
                                Swal.fire({
                                    icon: 'success',
                                    title: 'Logged out successfully!',
                                    toast: true,
                                    position: 'top-end',
                                    showConfirmButton: false,
                                    timer: 2000
                                });
            </script>
        </h:panelGroup>
    </h:body>
</html>
